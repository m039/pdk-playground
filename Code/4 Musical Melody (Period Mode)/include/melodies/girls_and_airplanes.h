#ifndef _GIRLS_AND_AIRPLANES_
#define _GIRLS_AND_AIRPLANES_

// https://www.youtube.com/watch?v=ACYB1XNs04w&list=RDACYB1XNs04w&start_radio=1
// https://midifind.com/files/n/narodnye_pesni_pervym_delom_samolety/208-1-0-4094

#include <stdint.h>
#include "delay.h"

#define NOTE_Db4 1
#define NOTE_F4 2
#define NOTE_Gb4 3
#define NOTE_Ab4 4
#define NOTE_C5 5
#define NOTE_C4 6
#define NOTE_G4 7
#define NOTE_Fb4 8
#define NOTE_Cb5 9
#define NOTE_Cb4 10
#define NOTE_Db5 11
#define NOTE_A4 12
#define NOTE_Gb5 13
#define NOTE_G5 14
#define NOTE_C6 15

#define TONE_FREQ (16000000 / (2 * 64 * 3))
#define F(x) (uint8_t)(TONE_FREQ / x - 1)
const uint8_t melody_tones[] = {
  0,
  F(311), // Db4
  F(349), // F4
  F(415), // Gb4
  F(466), // Ab4
  F(523), // C5
  F(262), // C4
  F(392), // G4
  F(370), // Fb4
  F(554), // Cb5
  F(277), // Cb4
  F(622), // Db5
  F(440), // A4
  F(831), // Gb5
  F(784), // G5
  F(1047), // C6
};

#define DURATION_0 0
#define DURATION_130 1
#define DURATION_135 2
#define DURATION_141 3
#define DURATION_146 4
#define DURATION_151 5
#define DURATION_156 6
#define DURATION_161 7
#define DURATION_167 8
#define DURATION_172 9
#define DURATION_177 10
#define DURATION_52 11
#define DURATION_182 12
#define DURATION_57 13
#define DURATION_188 14
#define DURATION_63 15
#define DURATION_193 16
#define DURATION_68 17
#define DURATION_198 18
#define DURATION_73 19
#define DURATION_78 20
#define DURATION_83 21
#define DURATION_89 22
#define DURATION_94 23
#define DURATION_354 24
#define DURATION_99 25
#define DURATION_104 26
#define DURATION_1000 27
#define DURATION_875 28
#define DURATION_109 29
#define DURATION_625 30
#define DURATION_115 31
#define DURATION_500 32
#define DURATION_375 33
#define DURATION_120 34
#define DURATION_1146 35
#define DURATION_125 36

const uint16_t melody_durations[] = {
  0, // 0
  130, // 1
  135, // 2
  141, // 3
  146, // 4
  151, // 5
  156, // 6
  161, // 7
  167, // 8
  172, // 9
  177, // 10
  52, // 11
  182, // 12
  57, // 13
  188, // 14
  63, // 15
  193, // 16
  68, // 17
  198, // 18
  73, // 19
  78, // 20
  83, // 21
  89, // 22
  94, // 23
  354, // 24
  99, // 25
  104, // 26
  1000, // 27
  875, // 28
  109, // 29
  625, // 30
  115, // 31
  500, // 32
  375, // 33
  120, // 34
  1146, // 35
  125, // 36
};

typedef struct {
    uint8_t t;
    uint8_t d;
    uint8_t nd;
} melody_data;

const melody_data melody[105] = {
  {NOTE_Db4, DURATION_167, DURATION_83},
  {NOTE_F4, DURATION_188, DURATION_63},
  {NOTE_Db4, DURATION_375, DURATION_125},
  {NOTE_Db4, DURATION_167, DURATION_83},
  {NOTE_F4, DURATION_177, DURATION_73},
  {NOTE_Db4, DURATION_375, DURATION_125},
  {NOTE_Gb4, DURATION_167, DURATION_83},
  {NOTE_Ab4, DURATION_172, DURATION_78},
  {NOTE_C5, DURATION_375, DURATION_125},
  {NOTE_Gb4, DURATION_500, DURATION_500},
  {NOTE_C5, DURATION_167, DURATION_83},
  {NOTE_Ab4, DURATION_188, DURATION_63},
  {NOTE_Gb4, DURATION_375, DURATION_125},
  {NOTE_C4, DURATION_146, DURATION_104},
  {NOTE_Db4, DURATION_177, DURATION_73},
  {NOTE_Ab4, DURATION_375, DURATION_125},
  {NOTE_Gb4, DURATION_161, DURATION_89},
  {NOTE_G4, DURATION_167, DURATION_83},
  {NOTE_F4, DURATION_1000, DURATION_500},
  {NOTE_F4, DURATION_161, DURATION_89},
  {NOTE_Fb4, DURATION_177, DURATION_73},
  {NOTE_F4, DURATION_375, DURATION_125},
  {NOTE_F4, DURATION_151, DURATION_99},
  {NOTE_Fb4, DURATION_156, DURATION_94},
  {NOTE_F4, DURATION_375, DURATION_125},
  {NOTE_Ab4, DURATION_167, DURATION_83},
  {NOTE_C5, DURATION_188, DURATION_63},
  {NOTE_Cb5, DURATION_375, DURATION_125},
  {NOTE_Ab4, DURATION_500, DURATION_500},
  {NOTE_Cb5, DURATION_193, DURATION_57},
  {NOTE_C5, DURATION_198, DURATION_52},
  {NOTE_Ab4, DURATION_375, DURATION_125},
  {NOTE_Cb4, DURATION_146, DURATION_104},
  {NOTE_F4, DURATION_146, DURATION_104},
  {NOTE_Ab4, DURATION_375, DURATION_125},
  {NOTE_Gb4, DURATION_167, DURATION_83},
  {NOTE_F4, DURATION_182, DURATION_68},
  {NOTE_Db4, DURATION_1146, DURATION_354},
  {NOTE_Db4, DURATION_146, DURATION_104},
  {NOTE_Db4, DURATION_188, DURATION_63},
  {NOTE_C5, DURATION_375, DURATION_125},
  {NOTE_C5, DURATION_135, DURATION_115},
  {NOTE_Ab4, DURATION_146, DURATION_104},
  {NOTE_Gb4, DURATION_146, DURATION_104},
  {NOTE_Gb4, DURATION_156, DURATION_94},
  {NOTE_G4, DURATION_167, DURATION_83},
  {NOTE_Gb4, DURATION_167, DURATION_83},
  {NOTE_Ab4, DURATION_375, DURATION_125},
  {NOTE_F4, DURATION_500, DURATION_500},
  {NOTE_F4, DURATION_156, DURATION_94},
  {NOTE_F4, DURATION_177, DURATION_73},
  {NOTE_Ab4, DURATION_375, DURATION_125},
  {NOTE_Ab4, DURATION_141, DURATION_109},
  {NOTE_Gb4, DURATION_151, DURATION_99},
  {NOTE_G4, DURATION_151, DURATION_99},
  {NOTE_Db4, DURATION_161, DURATION_89},
  {NOTE_F4, DURATION_172, DURATION_78},
  {NOTE_Db4, DURATION_167, DURATION_83},
  {NOTE_C5, DURATION_1000, DURATION_500},
  {NOTE_C5, DURATION_161, DURATION_89},
  {NOTE_Cb5, DURATION_172, DURATION_78},
  {NOTE_Db5, DURATION_167, DURATION_83},
  {NOTE_Cb5, DURATION_146, DURATION_104},
  {NOTE_C5, DURATION_156, DURATION_94},
  {NOTE_Ab4, DURATION_172, DURATION_78},
  {NOTE_A4, DURATION_135, DURATION_115},
  {NOTE_F4, DURATION_177, DURATION_73},
  {NOTE_Cb5, DURATION_156, DURATION_94},
  {NOTE_C5, DURATION_188, DURATION_63},
  {NOTE_Ab4, DURATION_375, DURATION_125},
  {NOTE_F4, DURATION_500, DURATION_500},
  {NOTE_Gb5, DURATION_161, DURATION_89},
  {NOTE_G5, DURATION_161, DURATION_89},
  {NOTE_C6, DURATION_146, DURATION_104},
  {NOTE_C6, DURATION_130, DURATION_120},
  {NOTE_C6, DURATION_135, DURATION_115},
  {NOTE_Gb4, DURATION_146, DURATION_104},
  {NOTE_Ab4, DURATION_146, DURATION_104},
  {NOTE_Ab4, DURATION_167, DURATION_83},
  {NOTE_Gb4, DURATION_161, DURATION_89},
  {NOTE_G4, DURATION_146, DURATION_104},
  {NOTE_F4, DURATION_875, DURATION_625},
  {NOTE_C5, DURATION_161, DURATION_89},
  {NOTE_Cb5, DURATION_172, DURATION_78},
  {NOTE_Db5, DURATION_167, DURATION_83},
  {NOTE_Cb5, DURATION_146, DURATION_104},
  {NOTE_C5, DURATION_156, DURATION_94},
  {NOTE_Ab4, DURATION_172, DURATION_78},
  {NOTE_A4, DURATION_135, DURATION_115},
  {NOTE_F4, DURATION_177, DURATION_73},
  {NOTE_Cb5, DURATION_156, DURATION_94},
  {NOTE_C5, DURATION_188, DURATION_63},
  {NOTE_Ab4, DURATION_375, DURATION_125},
  {NOTE_F4, DURATION_500, DURATION_500},
  {NOTE_Gb5, DURATION_161, DURATION_89},
  {NOTE_G5, DURATION_161, DURATION_89},
  {NOTE_C6, DURATION_146, DURATION_104},
  {NOTE_C6, DURATION_130, DURATION_120},
  {NOTE_C6, DURATION_135, DURATION_115},
  {NOTE_Gb4, DURATION_146, DURATION_104},
  {NOTE_Ab4, DURATION_146, DURATION_104},
  {NOTE_Ab4, DURATION_167, DURATION_83},
  {NOTE_Gb4, DURATION_161, DURATION_89},
  {NOTE_G4, DURATION_146, DURATION_104},
  {NOTE_F4, DURATION_875, DURATION_0},
};

#define MELODY_SIZE sizeof(melody) / sizeof(melody_data)
#define MELODY_TONE(x) melody_tones[melody[x].t]
#define MELODY_NO_TONE_DURATION(x) melody_durations[melody[x].nd]
#define MELODY_DURATION(x) melody_durations[melody[x].d]

void tone(uint8_t frequency)
{
  if (frequency <= 0) {
    TM2B = 0;
  } else {
    TM2S = 3 << 5 | 2;
    TM2B = frequency;
  }
}

#endif