#ifndef _WAKE_UP_AND_SInG_
#define _WAKE_UP_AND_SInG_

// https://www.youtube.com/watch?v=tcu1Q-WW8Gg&list=RDACYB1XNs04w&index=11
// https://www.midi-karaoke.info/21b8ca25.ru.html

#include <stdint.h>
#include "delay.h"

#define NOTE_F4 1
#define NOTE_A4 2
#define NOTE_D5 3
#define NOTE_E5 4
#define NOTE_Cb5 5
#define NOTE_F5 6
#define NOTE_C5 7
#define NOTE_B4 8
#define NOTE_G5 9
#define NOTE_A5 10
#define NOTE_Gb4 11
#define NOTE_E4 12

#define TONE_FREQ (16000000 / (2 * 64 * 3))
#define F(x) (uint8_t)(TONE_FREQ / x - 1)
const uint8_t melody_tones[] = {
  0,
  F(349), // F4
  F(440), // A4
  F(587), // D5
  F(659), // E5
  F(554), // Cb5
  F(698), // F5
  F(523), // C5
  F(494), // B4
  F(784), // G5
  F(880), // A5
  F(415), // Gb4
  F(330), // E4
};

#define DURATION_0 0
#define DURATION_1 1
#define DURATION_11 2
#define DURATION_12 3
#define DURATION_22 4
#define DURATION_24 5
#define DURATION_26 6
#define DURATION_28 7
#define DURATION_29 8
#define DURATION_31 9
#define DURATION_33 10
#define DURATION_36 11
#define DURATION_39 12
#define DURATION_41 13
#define DURATION_44 14
#define DURATION_46 15
#define DURATION_1070 16
#define DURATION_49 17
#define DURATION_50 18
#define DURATION_51 19
#define DURATION_53 20
#define DURATION_55 21
#define DURATION_56 22
#define DURATION_57 23
#define DURATION_58 24
#define DURATION_59 25
#define DURATION_60 26
#define DURATION_61 27
#define DURATION_63 28
#define DURATION_64 29
#define DURATION_65 30
#define DURATION_67 31
#define DURATION_68 32
#define DURATION_70 33
#define DURATION_71 34
#define DURATION_72 35
#define DURATION_73 36
#define DURATION_75 37
#define DURATION_76 38
#define DURATION_78 39
#define DURATION_81 40
#define DURATION_87 41
#define DURATION_88 42
#define DURATION_90 43
#define DURATION_91 44
#define DURATION_92 45
#define DURATION_94 46
#define DURATION_95 47
#define DURATION_96 48
#define DURATION_97 49
#define DURATION_99 50
#define DURATION_100 51
#define DURATION_101 52
#define DURATION_102 53
#define DURATION_103 54
#define DURATION_105 55
#define DURATION_106 56
#define DURATION_107 57
#define DURATION_108 58
#define DURATION_109 59
#define DURATION_110 60
#define DURATION_114 61
#define DURATION_116 62
#define DURATION_117 63
#define DURATION_118 64
#define DURATION_120 65
#define DURATION_121 66
#define DURATION_123 67
#define DURATION_126 68
#define DURATION_130 69
#define DURATION_133 70
#define DURATION_138 71
#define DURATION_139 72
#define DURATION_143 73
#define DURATION_145 74
#define DURATION_154 75
#define DURATION_155 76
#define DURATION_161 77
#define DURATION_166 78
#define DURATION_174 79
#define DURATION_214 80
#define DURATION_217 81
#define DURATION_223 82
#define DURATION_228 83
#define DURATION_232 84
#define DURATION_236 85
#define DURATION_238 86
#define DURATION_242 87
#define DURATION_244 88
#define DURATION_246 89
#define DURATION_252 90
#define DURATION_255 91
#define DURATION_257 92
#define DURATION_261 93
#define DURATION_264 94
#define DURATION_267 95
#define DURATION_272 96
#define DURATION_276 97
#define DURATION_278 98
#define DURATION_280 99
#define DURATION_295 100
#define DURATION_302 101
#define DURATION_307 102
#define DURATION_326 103
#define DURATION_339 104
#define DURATION_343 105
#define DURATION_355 106
#define DURATION_367 107
#define DURATION_374 108
#define DURATION_905 109
#define DURATION_438 110
#define DURATION_465 111
#define DURATION_991 112

const uint32_t melody_durations[] = {
  LOOP_CTR_32(MS_TO_CYCLES(0)), // 0
  LOOP_CTR_32(MS_TO_CYCLES(1)), // 1
  LOOP_CTR_32(MS_TO_CYCLES(11)), // 2
  LOOP_CTR_32(MS_TO_CYCLES(12)), // 3
  LOOP_CTR_32(MS_TO_CYCLES(22)), // 4
  LOOP_CTR_32(MS_TO_CYCLES(24)), // 5
  LOOP_CTR_32(MS_TO_CYCLES(26)), // 6
  LOOP_CTR_32(MS_TO_CYCLES(28)), // 7
  LOOP_CTR_32(MS_TO_CYCLES(29)), // 8
  LOOP_CTR_32(MS_TO_CYCLES(31)), // 9
  LOOP_CTR_32(MS_TO_CYCLES(33)), // 10
  LOOP_CTR_32(MS_TO_CYCLES(36)), // 11
  LOOP_CTR_32(MS_TO_CYCLES(39)), // 12
  LOOP_CTR_32(MS_TO_CYCLES(41)), // 13
  LOOP_CTR_32(MS_TO_CYCLES(44)), // 14
  LOOP_CTR_32(MS_TO_CYCLES(46)), // 15
  LOOP_CTR_32(MS_TO_CYCLES(1070)), // 16
  LOOP_CTR_32(MS_TO_CYCLES(49)), // 17
  LOOP_CTR_32(MS_TO_CYCLES(50)), // 18
  LOOP_CTR_32(MS_TO_CYCLES(51)), // 19
  LOOP_CTR_32(MS_TO_CYCLES(53)), // 20
  LOOP_CTR_32(MS_TO_CYCLES(55)), // 21
  LOOP_CTR_32(MS_TO_CYCLES(56)), // 22
  LOOP_CTR_32(MS_TO_CYCLES(57)), // 23
  LOOP_CTR_32(MS_TO_CYCLES(58)), // 24
  LOOP_CTR_32(MS_TO_CYCLES(59)), // 25
  LOOP_CTR_32(MS_TO_CYCLES(60)), // 26
  LOOP_CTR_32(MS_TO_CYCLES(61)), // 27
  LOOP_CTR_32(MS_TO_CYCLES(63)), // 28
  LOOP_CTR_32(MS_TO_CYCLES(64)), // 29
  LOOP_CTR_32(MS_TO_CYCLES(65)), // 30
  LOOP_CTR_32(MS_TO_CYCLES(67)), // 31
  LOOP_CTR_32(MS_TO_CYCLES(68)), // 32
  LOOP_CTR_32(MS_TO_CYCLES(70)), // 33
  LOOP_CTR_32(MS_TO_CYCLES(71)), // 34
  LOOP_CTR_32(MS_TO_CYCLES(72)), // 35
  LOOP_CTR_32(MS_TO_CYCLES(73)), // 36
  LOOP_CTR_32(MS_TO_CYCLES(75)), // 37
  LOOP_CTR_32(MS_TO_CYCLES(76)), // 38
  LOOP_CTR_32(MS_TO_CYCLES(78)), // 39
  LOOP_CTR_32(MS_TO_CYCLES(81)), // 40
  LOOP_CTR_32(MS_TO_CYCLES(87)), // 41
  LOOP_CTR_32(MS_TO_CYCLES(88)), // 42
  LOOP_CTR_32(MS_TO_CYCLES(90)), // 43
  LOOP_CTR_32(MS_TO_CYCLES(91)), // 44
  LOOP_CTR_32(MS_TO_CYCLES(92)), // 45
  LOOP_CTR_32(MS_TO_CYCLES(94)), // 46
  LOOP_CTR_32(MS_TO_CYCLES(95)), // 47
  LOOP_CTR_32(MS_TO_CYCLES(96)), // 48
  LOOP_CTR_32(MS_TO_CYCLES(97)), // 49
  LOOP_CTR_32(MS_TO_CYCLES(99)), // 50
  LOOP_CTR_32(MS_TO_CYCLES(100)), // 51
  LOOP_CTR_32(MS_TO_CYCLES(101)), // 52
  LOOP_CTR_32(MS_TO_CYCLES(102)), // 53
  LOOP_CTR_32(MS_TO_CYCLES(103)), // 54
  LOOP_CTR_32(MS_TO_CYCLES(105)), // 55
  LOOP_CTR_32(MS_TO_CYCLES(106)), // 56
  LOOP_CTR_32(MS_TO_CYCLES(107)), // 57
  LOOP_CTR_32(MS_TO_CYCLES(108)), // 58
  LOOP_CTR_32(MS_TO_CYCLES(109)), // 59
  LOOP_CTR_32(MS_TO_CYCLES(110)), // 60
  LOOP_CTR_32(MS_TO_CYCLES(114)), // 61
  LOOP_CTR_32(MS_TO_CYCLES(116)), // 62
  LOOP_CTR_32(MS_TO_CYCLES(117)), // 63
  LOOP_CTR_32(MS_TO_CYCLES(118)), // 64
  LOOP_CTR_32(MS_TO_CYCLES(120)), // 65
  LOOP_CTR_32(MS_TO_CYCLES(121)), // 66
  LOOP_CTR_32(MS_TO_CYCLES(123)), // 67
  LOOP_CTR_32(MS_TO_CYCLES(126)), // 68
  LOOP_CTR_32(MS_TO_CYCLES(130)), // 69
  LOOP_CTR_32(MS_TO_CYCLES(133)), // 70
  LOOP_CTR_32(MS_TO_CYCLES(138)), // 71
  LOOP_CTR_32(MS_TO_CYCLES(139)), // 72
  LOOP_CTR_32(MS_TO_CYCLES(143)), // 73
  LOOP_CTR_32(MS_TO_CYCLES(145)), // 74
  LOOP_CTR_32(MS_TO_CYCLES(154)), // 75
  LOOP_CTR_32(MS_TO_CYCLES(155)), // 76
  LOOP_CTR_32(MS_TO_CYCLES(161)), // 77
  LOOP_CTR_32(MS_TO_CYCLES(166)), // 78
  LOOP_CTR_32(MS_TO_CYCLES(174)), // 79
  LOOP_CTR_32(MS_TO_CYCLES(214)), // 80
  LOOP_CTR_32(MS_TO_CYCLES(217)), // 81
  LOOP_CTR_32(MS_TO_CYCLES(223)), // 82
  LOOP_CTR_32(MS_TO_CYCLES(228)), // 83
  LOOP_CTR_32(MS_TO_CYCLES(232)), // 84
  LOOP_CTR_32(MS_TO_CYCLES(236)), // 85
  LOOP_CTR_32(MS_TO_CYCLES(238)), // 86
  LOOP_CTR_32(MS_TO_CYCLES(242)), // 87
  LOOP_CTR_32(MS_TO_CYCLES(244)), // 88
  LOOP_CTR_32(MS_TO_CYCLES(246)), // 89
  LOOP_CTR_32(MS_TO_CYCLES(252)), // 90
  LOOP_CTR_32(MS_TO_CYCLES(255)), // 91
  LOOP_CTR_32(MS_TO_CYCLES(257)), // 92
  LOOP_CTR_32(MS_TO_CYCLES(261)), // 93
  LOOP_CTR_32(MS_TO_CYCLES(264)), // 94
  LOOP_CTR_32(MS_TO_CYCLES(267)), // 95
  LOOP_CTR_32(MS_TO_CYCLES(272)), // 96
  LOOP_CTR_32(MS_TO_CYCLES(276)), // 97
  LOOP_CTR_32(MS_TO_CYCLES(278)), // 98
  LOOP_CTR_32(MS_TO_CYCLES(280)), // 99
  LOOP_CTR_32(MS_TO_CYCLES(295)), // 100
  LOOP_CTR_32(MS_TO_CYCLES(302)), // 101
  LOOP_CTR_32(MS_TO_CYCLES(307)), // 102
  LOOP_CTR_32(MS_TO_CYCLES(326)), // 103
  LOOP_CTR_32(MS_TO_CYCLES(339)), // 104
  LOOP_CTR_32(MS_TO_CYCLES(343)), // 105
  LOOP_CTR_32(MS_TO_CYCLES(355)), // 106
  LOOP_CTR_32(MS_TO_CYCLES(367)), // 107
  LOOP_CTR_32(MS_TO_CYCLES(374)), // 108
  LOOP_CTR_32(MS_TO_CYCLES(905)), // 109
  LOOP_CTR_32(MS_TO_CYCLES(438)), // 110
  LOOP_CTR_32(MS_TO_CYCLES(465)), // 111
  LOOP_CTR_32(MS_TO_CYCLES(991)), // 112
};

typedef struct {
    uint8_t t;
    uint8_t d;
    uint8_t nd;
} melody_data;

const melody_data melody[93] = {
  {NOTE_F4, DURATION_91, DURATION_76},
  {NOTE_F4, DURATION_95, DURATION_72},
  {NOTE_F4, DURATION_94, DURATION_73},
  {NOTE_A4, DURATION_264, DURATION_70},
  {NOTE_D5, DURATION_103, DURATION_64},
  {NOTE_E5, DURATION_272, DURATION_61},
  {NOTE_D5, DURATION_106, DURATION_60},
  {NOTE_Cb5, DURATION_276, DURATION_57},
  {NOTE_D5, DURATION_118, DURATION_49},
  {NOTE_F4, DURATION_91, DURATION_76},
  {NOTE_F4, DURATION_95, DURATION_72},
  {NOTE_F4, DURATION_94, DURATION_73},
  {NOTE_A4, DURATION_264, DURATION_70},
  {NOTE_D5, DURATION_103, DURATION_64},
  {NOTE_E5, DURATION_272, DURATION_61},
  {NOTE_D5, DURATION_106, DURATION_60},
  {NOTE_Cb5, DURATION_276, DURATION_57},
  {NOTE_D5, DURATION_118, DURATION_49},
  {NOTE_F5, DURATION_94, DURATION_73},
  {NOTE_F5, DURATION_95, DURATION_72},
  {NOTE_F5, DURATION_100, DURATION_67},
  {NOTE_E5, DURATION_267, DURATION_67},
  {NOTE_D5, DURATION_106, DURATION_60},
  {NOTE_C5, DURATION_255, DURATION_78},
  {NOTE_B4, DURATION_110, DURATION_56},
  {NOTE_A4, DURATION_257, DURATION_76},
  {NOTE_B4, DURATION_116, DURATION_51},
  {NOTE_C5, DURATION_326, DURATION_174},
  {NOTE_C5, DURATION_367, DURATION_133},
  {NOTE_E5, DURATION_355, DURATION_145},
  {NOTE_G5, DURATION_339, DURATION_161},
  {NOTE_A5, DURATION_244, DURATION_90},
  {NOTE_G5, DURATION_118, DURATION_49},
  {NOTE_A5, DURATION_223, DURATION_110},
  {NOTE_G5, DURATION_108, DURATION_58},
  {NOTE_A5, DURATION_228, DURATION_105},
  {NOTE_G5, DURATION_102, DURATION_65},
  {NOTE_E5, DURATION_252, DURATION_81},
  {NOTE_C5, DURATION_126, DURATION_41},
  {NOTE_D5, DURATION_246, DURATION_88},
  {NOTE_C5, DURATION_99, DURATION_68},
  {NOTE_D5, DURATION_307, DURATION_26},
  {NOTE_C5, DURATION_374, DURATION_126},
  {NOTE_C5, DURATION_109, DURATION_57},
  {NOTE_C5, DURATION_244, DURATION_90},
  {NOTE_C5, DURATION_114, DURATION_53},
  {NOTE_F5, DURATION_236, DURATION_97},
  {NOTE_E5, DURATION_117, DURATION_50},
  {NOTE_Cb5, DURATION_252, DURATION_81},
  {NOTE_A4, DURATION_166, DURATION_1},
  {NOTE_F5, DURATION_252, DURATION_81},
  {NOTE_E5, DURATION_103, DURATION_64},
  {NOTE_Cb5, DURATION_272, DURATION_61},
  {NOTE_A4, DURATION_121, DURATION_46},
  {NOTE_D5, DURATION_991, DURATION_343},
  {NOTE_C5, DURATION_102, DURATION_65},
  {NOTE_C5, DURATION_214, DURATION_120},
  {NOTE_C5, DURATION_107, DURATION_59},
  {NOTE_C5, DURATION_236, DURATION_97},
  {NOTE_A4, DURATION_110, DURATION_56},
  {NOTE_C5, DURATION_264, DURATION_49},
  {NOTE_B4, DURATION_465, DURATION_56},
  {NOTE_B4, DURATION_123, DURATION_44},
  {NOTE_Gb4, DURATION_252, DURATION_81},
  {NOTE_E4, DURATION_145, DURATION_22},
  {NOTE_D5, DURATION_238, DURATION_75},
  {NOTE_B4, DURATION_126, DURATION_61},
  {NOTE_D5, DURATION_280, DURATION_53},
  {NOTE_C5, DURATION_438, DURATION_63},
  {NOTE_C5, DURATION_155, DURATION_11},
  {NOTE_D5, DURATION_242, DURATION_92},
  {NOTE_E5, DURATION_118, DURATION_49},
  {NOTE_G5, DURATION_261, DURATION_72},
  {NOTE_F5, DURATION_138, DURATION_29},
  {NOTE_F5, DURATION_272, DURATION_61},
  {NOTE_E5, DURATION_130, DURATION_36},
  {NOTE_E5, DURATION_252, DURATION_81},
  {NOTE_D5, DURATION_143, DURATION_24},
  {NOTE_C5, DURATION_246, DURATION_87},
  {NOTE_B4, DURATION_133, DURATION_33},
  {NOTE_E5, DURATION_1070, DURATION_264},
  {NOTE_C5, DURATION_139, DURATION_28},
  {NOTE_D5, DURATION_232, DURATION_101},
  {NOTE_E5, DURATION_114, DURATION_53},
  {NOTE_G5, DURATION_217, DURATION_117},
  {NOTE_F5, DURATION_96, DURATION_71},
  {NOTE_F5, DURATION_302, DURATION_31},
  {NOTE_E5, DURATION_126, DURATION_41},
  {NOTE_E5, DURATION_295, DURATION_39},
  {NOTE_D5, DURATION_138, DURATION_29},
  {NOTE_C5, DURATION_278, DURATION_55},
  {NOTE_B4, DURATION_154, DURATION_12},
  {NOTE_C5, DURATION_905, DURATION_0},
};

#define MELODY_SIZE sizeof(melody) / sizeof(melody_data)
#define MELODY_TONE(x) melody_tones[melody[x].t]
#define MELODY_NO_TONE_DURATION(x) melody_durations[melody[x].nd]
#define MELODY_DURATION(x) melody_durations[melody[x].d]

void tone(uint8_t frequency)
{
  if (frequency <= 0) {
    TM2B = 0;
  } else {
    TM2S = 3 << 5 | 2;
    TM2B = frequency;
  }
}

#endif